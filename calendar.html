<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendar – The Flying 64th</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1115; --ink:#e9eef7; --muted:#b9c2d0;
      --panel:#151924; --panel2:#0d1018;
      --accent:#4da3ff; --rule:rgba(255,255,255,.10); --border:rgba(255,255,255,.12);
      --radius:12px;

      --blue:#4da3ff;   /* N78710 C172 */
      --green:#58d68d;  /* N10921 C150 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--ink);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* ===== NAV ===== */
    .site-header{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(160%) blur(8px);
      background:rgba(11,17,23,.75);
      border-bottom:1px solid var(--rule);
    }
    .nav{
      max-width:1400px; margin:0 auto; padding:12px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; color:var(--ink); text-decoration:none; font-size:22px }
    .brand img{ height:34px }
    nav.links{ display:flex; gap:18px; align-items:center }
    nav.links a{
      color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px; transition:.18s;
    }
    nav.links a:hover{ color:var(--ink); background:rgba(255,255,255,.06) }
    nav.links a.active{ color:#001a33; background:var(--accent); font-weight:700 }
    .btn{border:1px solid var(--border); background:#0c1020; color:#eaf2ff; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
    .btn.primary{ background:linear-gradient(180deg,#2b6bb1,#1c4370); border:1px solid #2b6bb1 }
    #signinBtn{ margin-right:8px; }

    /* ===== BANNER ===== */
    .banner{ max-width:1400px; margin:12px auto 0; padding:0 18px }
    .banner-inner{
      display:flex; gap:12px; align-items:flex-start;
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border); border-left:4px solid var(--accent);
      border-radius:12px; padding:12px 14px;
    }
    .banner .icon{ font-size:22px }
    .banner strong{ color:#cfe1ff }

    /* ===== WRAP / TOOLBAR ===== */
    .wrap{ max-width:1400px; margin:16px auto 80px; padding:0 18px }
    .toolbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border); border-radius:12px; padding:10px;
    }
    .pills{ display:flex; gap:8px; flex-wrap:wrap }
    .pill{
      border:1px solid var(--border); background:#0c0f18; color:#eaf2ff;
      padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; font-size:14px;
    }
    .pill.active{ background:#0e1630; border-color:rgba(77,163,255,.45) }

    /* ===== STATUS CARDS ===== */
    .status-row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px }
    .card{
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border); border-radius:12px; padding:12px 14px;
    }
    .card h3{ margin:0 0 6px; font-size:16px }
    .chip{ display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700; }
    .chip.blue{ background:#1a2d46; color:#cfe1ff; border:1px solid rgba(77,163,255,.35) }
    .chip.green{ background:#123326; color:#d7ffea; border:1px solid rgba(88,214,141,.35) }
    .meter{ display:flex; gap:16px; color:#cfe1ff }
    .meter b{ color:#fff }
    .sub{ color:var(--muted); font-size:12px; margin-top:6px }

    /* ===== CALENDAR BAR ===== */
    .calbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-top:12px; padding:10px;
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border); border-radius:12px;
    }
    .navbtns,.viewbtns{ display:flex; gap:6px; align-items:center }
    .sbtn{
      border:1px solid var(--border); background:#0c0f18; color:#eaf2ff;
      padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600;
    }
    .title{ font-weight:800; letter-spacing:.2px }

    /* ===== MONTH GRID ===== */
    .calendar{
      margin-top:12px; width:100%;
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border); border-radius:12px; overflow:hidden;
    }
    .dow{ display:grid; grid-template-columns:repeat(7,1fr); background:#0c0f18; border-bottom:1px solid var(--border) }
    .dow div{ padding:10px; text-align:center; color:#cfe1ff; font-weight:700; font-size:13px }
    .grid{ display:grid; grid-template-columns:repeat(7,1fr) }
    .cell{ min-height:120px; border-right:1px solid var(--border); border-bottom:1px solid var(--border); padding:8px; position:relative }
    .cell:nth-child(7n){ border-right:none }
    .date{ position:absolute; top:6px; right:8px; font-size:12px; color:#cfe1ff; padding:2px 6px; border-radius:6px; background:rgba(255,255,255,.05) }
    .other-month .date{ opacity:.35 }
    .today .date{ background:#2b6bb1; color:#001a33; font-weight:800 }
    .events{ margin-top:22px; display:flex; flex-direction:column; gap:6px }
    .evt{ font-size:12px; padding:4px 6px; border-radius:6px; border:1px solid transparent; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .evt.c172{ background:#0e1d31; border-color:#2b6bb1 }
    .evt.c150{ background:#0f261c; border-color:#2b7a55 }

    /* ===== MODALS (Auth + Booking) ===== */
    .auth-modal,
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; place-items:center; z-index:1000 }
    .auth-modal.open,
    .modal-backdrop.open{ display:grid }

    .auth-card,
    .modal{ width:min(820px,92vw); background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.5); color:#e6edf3 }

    .auth-card{ padding:18px 18px 12px; position:relative }
    .auth-title{ margin:0 0 10px; font-size:20px; font-weight:800 }
    .auth-x{ position:absolute; right:14px; top:12px; border:0; background:transparent; color:#9fb1c3; font-size:18px; cursor:pointer }
    .auth-label{ display:block; margin-top:10px; margin-bottom:4px; color:#9fb1c3; font-size:13px }
    .auth-input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #1f2a38; background:#0b1117; color:#e6edf3 }
    .auth-row{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:12px }
    .auth-btn{ flex:1; padding:10px 12px; border-radius:10px; border:1px solid #1f2a38; background:#141b26; color:#e6edf3; cursor:pointer }
    .auth-btn.primary{ background:#58a6ff; color:#001a33; border-color:transparent; font-weight:700 }
    .auth-link{ background:none; border:0; color:#9fb1c3; cursor:pointer }
    .auth-msg{ min-height:18px; color:#9fb1c3; margin:8px 0 4px }

    .modal-header{ padding:12px 16px; border-bottom:1px solid var(--border); display:flex; gap:10px; align-items:center }
    .modal-title{ flex:1; font-size:20px; font-weight:700; color:#e5f0ff }
    .modal-body{ padding:16px; display:grid; gap:14px }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .row-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px }
    .field{ display:flex; flex-direction:column; gap:6px }
    .field span{ font-size:13px; color:#cfe1ff }
    input,select,textarea{ background:#0b0e15; color:var(--ink); border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none; width:100% }
    textarea{ min-height:84px; resize:vertical }
    .inline{ display:flex; align-items:center; gap:10px }
    .switch{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none }
    .switch input{ appearance:none; width:36px; height:22px; border-radius:999px; background:#444; position:relative; transition:.2s }
    .switch input:checked{ background:#2b6bb1 }
    .switch input::after{ content:""; position:absolute; top:3px; left:3px; width:16px; height:16px; border-radius:50%; background:#fff; transition:.2s }
    .switch input:checked::after{ transform:translateX(14px) }
    .modal-footer{ padding:12px 16px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:8px }
    .hint{ color:#b9c2d0; font-size:12.5px }

    @media (max-width:900px){
      .status-row{ grid-template-columns:1fr }
      .row,.row-3{ grid-template-columns:1fr }
    }
  </style>
</head>
<body>

  <!-- ===== NAV ===== -->
  <header class="site-header">
    <div class="nav">
      <a href="home.html" class="brand">
        <img src="images/flying64thlogo.png" alt="The Flying 64th Logo">
        <span>The Flying 64th</span>
      </a>
      <nav class="links">
        <a id="signinBtn" class="btn">Sign In</a>
        <a href="home.html">Home</a>
        <a class="active" href="calendar.html">Calendar</a>
        <a href="becomeamember.html">Become a Member</a>
        <a href="photos.html">Photos</a>
        <a href="poh&manuals.html">POH &amp; Manuals</a>
      </nav>
    </div>
  </header>

  <!-- ===== AUTH MODAL (copied pattern) ===== -->
  <div id="authModal" class="auth-modal" aria-hidden="true">
    <div class="auth-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <button id="closeAuth" class="auth-x" aria-label="Close">✕</button>
      <h3 id="authTitle" class="auth-title">Member Sign In</h3>

      <label class="auth-label" for="em">Email</label>
      <input id="em" class="auth-input" type="email" placeholder="you@example.com" autocomplete="email">

      <label class="auth-label" for="pw">Password</label>
      <input id="pw" class="auth-input" type="password" placeholder="••••••••" autocomplete="current-password">

      <label class="auth-label" for="invite">Invite Code (new accounts)</label>
      <input id="invite" class="auth-input" type="text" placeholder="Board Admin Will Provide Invite Code">

      <div class="auth-row">
        <button id="doSignIn" class="auth-btn primary">Sign In</button>
        <button id="doSignUp" class="auth-btn">Create Account</button>
      </div>

      <div class="auth-row">
        <button id="doReset" class="auth-link" type="button">Forgot password?</button>
        <button id="doSignOut" class="auth-link" type="button">Sign out</button>
      </div>

      <p id="authMsg" class="auth-msg"></p>
    </div>
  </div>

  <!-- ===== BANNER ===== -->
  <div class="banner">
    <div class="banner-inner">
      <div class="icon">⏱️</div>
      <div>
        <strong>Reminder:</strong>
        Enter <strong>Tach</strong> &amp; <strong>Hobbs</strong> start/end after every flight.
        If the prior end is missing, you’ll be prompted to resolve it before <strong>closing your flight</strong>.
      </div>
    </div>
  </div>

  <main class="wrap">
    <!-- ===== FILTER / NEW BOOKING ===== -->
    <div class="toolbar">
      <div class="pills" role="tablist">
        <button class="pill active" data-filter="ALL">All</button>
        <button class="pill" data-filter="N78710">N78710 — C172</button>
        <button class="pill" data-filter="N10921">N10921 — C150</button>
      </div>
      <div>
        <button id="newBooking" class="btn primary">＋ New booking</button>
        <button class="btn" title="Export coming soon" disabled>Export</button>
      </div>
    </div>

    <!-- ===== AIRCRAFT STATUS ===== -->
    <div class="status-row">
      <div class="card" id="card-78710">
        <h3><span class="chip blue">N78710 — C172</span></h3>
        <div class="meter"><div>Tach: <b id="tach-78710">—</b></div><div>Hobbs: <b id="hobbs-78710">—</b></div></div>
        <div class="sub" id="sub-78710">Last updated: —</div>
      </div>
      <div class="card" id="card-10921">
        <h3><span class="chip green">N10921 — C150</span></h3>
        <div class="meter"><div>Tach: <b id="tach-10921">—</b></div><div>Hobbs: <b id="hobbs-10921">—</b></div></div>
        <div class="sub" id="sub-10921">Last updated: —</div>
      </div>
    </div>

    <!-- ===== CALENDAR BAR ===== -->
    <div class="calbar">
      <div class="navbtns">
        <button class="sbtn" id="prevBtn">◀</button>
        <button class="sbtn" id="todayBtn">Today</button>
        <button class="sbtn" id="nextBtn">▶</button>
      </div>
      <div class="title" id="rangeTitle">Month YYYY</div>
      <div class="viewbtns">
        <button class="sbtn" disabled>Month</button>
        <button class="sbtn" disabled>Week</button>
        <button class="sbtn" disabled>Day</button>
      </div>
    </div>

    <!-- ===== MONTH CALENDAR ===== -->
    <section class="calendar" id="calendar">
      <div class="dow">
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
      </div>
      <div class="grid" id="grid"></div>
    </section>
  </main>

  <!-- ===== BOOKING MODAL ===== -->
  <div id="bookingModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Add title and time</div>
        <button id="closeModal" class="btn">✕</button>
      </div>

      <div class="modal-body">
        <!-- Member identity -->
        <div class="row">
          <label class="field">
            <span>First name</span>
            <input id="firstName" type="text" placeholder="e.g., John" required />
          </label>
          <label class="field">
            <span>Last name</span>
            <input id="lastName" type="text" placeholder="e.g., Doe" required />
          </label>
        </div>
        <label class="field">
          <span>Email (from sign-in)</span>
          <input id="emailField" type="email" readonly placeholder="Sign in to populate" />
        </label>

        <!-- Aircraft -->
        <label class="field">
          <span>Aircraft</span>
          <select id="aircraft" required>
            <option value="" selected disabled>Select aircraft</option>
            <option value="N78710">N78710 — Cessna 172</option>
            <option value="N10921">N10921 — Cessna 150</option>
          </select>
        </label>

        <!-- Title -->
        <label class="field">
          <span>Title</span>
          <input id="titleInput" type="text" placeholder="e.g., Training flight" />
        </label>

        <!-- Dates / Times -->
        <div class="row">
          <label class="field"><span>Start date</span><input id="startDate" type="date" /></label>
          <label class="field"><span>End date</span><input id="endDate" type="date" /></label>
        </div>
        <div class="row">
          <label class="field"><span>Start time</span><input id="startTime" type="time" step="900" /></label>
          <label class="field"><span>End time</span><input id="endTime" type="time" step="900" /></label>
        </div>
        <div class="inline">
          <label class="switch"><input id="allDay" type="checkbox" /> <span>All day</span></label>
          <span class="hint">Times disabled when all-day is on.</span>
        </div>

        <!-- Instructor -->
        <div class="row">
          <div class="field">
            <span>Book with instructor?</span>
            <label class="switch"><input id="withInstructor" type="checkbox" /> <span>Yes</span></label>
          </div>
          <label class="field" id="instructorWrap" hidden>
            <span>Instructor</span>
            <select id="instructorSelect">
              <option value="" selected disabled>Choose flight instructor</option>
              <option value="BW">Brian Westfall (BW)</option>
              <option value="JC">Justin Cox (JC)</option>
              <option value="JM">Jeff Moersch (JM)</option>
            </select>
          </label>
        </div>

        <!-- Meter Readings -->
        <div class="row-3">
          <label class="field"><span>Tach start</span><input id="tachStart" type="number" step="0.1" /></label>
          <label class="field"><span>Tach end</span><input id="tachEnd" type="number" step="0.1" /></label>
          <label class="field"><span>Tach delta</span><input id="tachDelta" type="number" step="0.1" readonly /></label>
        </div>
        <div class="row-3">
          <label class="field"><span>Hobbs start</span><input id="hobbsStart" type="number" step="0.1" /></label>
          <label class="field"><span>Hobbs end</span><input id="hobbsEnd" type="number" step="0.1" /></label>
          <label class="field"><span>Hobbs delta</span><input id="hobbsDelta" type="number" step="0.1" readonly /></label>
        </div>

        <!-- Comments -->
        <label class="field"><span>Comments</span><textarea id="comments"></textarea></label>

        <div id="authHint" class="hint" style="display:none">Sign in to book. Your email is shared with members for coordination.</div>
      </div>

      <div class="modal-footer">
        <button id="cancelModal" class="btn">Cancel</button>
        <button id="saveBooking" class="btn primary" disabled>Save</button>
      </div>
    </div>
  </div>

  <!-- ===== YEAR FOR FOOTER-LIKE USE (OPTIONAL) ===== -->
  <script>
    // Highlight active nav
    (function(){
      const current = location.pathname.split('/').pop().toLowerCase();
      document.querySelectorAll('nav.links a').forEach(a=>{
        let href=(a.getAttribute('href')||'').split('?')[0].toLowerCase();
        href=href.replace(/&amp;/g,'&');
        if(href && href===current) a.classList.add('active');
      });
    })();
  </script>

  <!-- ===== Firebase + Auth (same config as Home) ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      signInWithEmailAndPassword, createUserWithEmailAndPassword,
      sendPasswordResetEmail, sendEmailVerification, signOut
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
    import {
      getFirestore, doc, getDoc, updateDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAI5lb0nXxAiBQThX6Y4tEQuqQ1cY6bn74",
      authDomain: "flying64th-b7813.firebaseapp.com",
      projectId: "flying64th-b7813",
      storageBucket: "flying64th-b7813.firebasestorage.app",
      messagingSenderId: "244940935157",
      appId: "1:244940935157:web:58e7305541377ba743dabc"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // ===== Auth modal wiring
    const signinBtn = document.getElementById('signinBtn');
    const authModal = document.getElementById('authModal');
    const closeAuth = document.getElementById('closeAuth');
    const em = document.getElementById('em');
    const pw = document.getElementById('pw');
    const invite = document.getElementById('invite');
    const doSignIn = document.getElementById('doSignIn');
    const doSignUp = document.getElementById('doSignUp');
    const doReset  = document.getElementById('doReset');
    const doSignOut= document.getElementById('doSignOut');
    const authMsg  = document.getElementById('authMsg');

    function say(t, err=false){ authMsg.textContent=t||""; authMsg.style.color=err?'#ffb4b4':'#9fb1c3'; }
    function openAuth(){ authModal.classList.add('open'); authModal.setAttribute('aria-hidden','false'); say(""); }
    function closeAuthModal(){ authModal.classList.remove('open'); authModal.setAttribute('aria-hidden','true'); }

    signinBtn.addEventListener('click', openAuth);
    closeAuth.addEventListener('click', closeAuthModal);
    authModal.addEventListener('click', (e)=>{ if(e.target===authModal) closeAuthModal(); });

    doSignIn.addEventListener('click', async ()=>{
      try{
        if(!em.value || !pw.value) return say("Enter email and password.", true);
        await signInWithEmailAndPassword(auth, em.value.trim(), pw.value);
        say("Signed in."); closeAuthModal();
      }catch(err){ say(err.message, true); }
    });

    doSignUp.addEventListener('click', async ()=>{
      try{
        if(!em.value || !pw.value || !invite.value) return say("Email, password, and invite code are required.", true);
        // basic invite document check (optional)
        const ref = doc(db, "invites", invite.value.trim());
        const snap = await getDoc(ref);
        if(!snap.exists()) return say("Invalid invite code.", true);
        const cred = await createUserWithEmailAndPassword(auth, em.value.trim(), pw.value);
        await sendEmailVerification(cred.user);
        await updateDoc(ref, { used:true, usedByLast:cred.user.uid, usedAtLast:serverTimestamp() });
        say("Account created! Check your inbox to verify your email.");
      }catch(err){ say(err.message, true); }
    });

    doReset.addEventListener('click', async ()=>{
      try{
        if(!em.value) return say("Enter your email first.", true);
        await sendPasswordResetEmail(auth, em.value.trim());
        say("Password reset email sent.");
      }catch(err){ say(err.message, true); }
    });

    doSignOut.addEventListener('click', async ()=>{ await signOut(auth); say("Signed out."); });

    // Booking modal controls need auth state
    const emailField   = document.getElementById('emailField');
    const authHint     = document.getElementById('authHint');
    const saveBtn      = document.getElementById('saveBooking');

    onAuthStateChanged(auth, (user)=>{
      if(user){
        const short = user.email && user.email.length>25 ? user.email.slice(0,25)+"…" : (user.email||"");
        signinBtn.textContent = user.emailVerified ? `Account – ${short}` : `Unverified – ${short}`;
        emailField.value = user.email||"";
        saveBtn.disabled = false;
        authHint.style.display = "none";
      }else{
        signinBtn.textContent = "Sign In";
        emailField.value = "";
        saveBtn.disabled = true;
        authHint.style.display = "block";
      }
    });

    // ===== Calendar logic (month grid)
    const grid = document.getElementById('grid');
    const titleEl = document.getElementById('rangeTitle');
    let today = new Date();
    let viewDate = new Date(today.getFullYear(), today.getMonth(), 1);

    function fmtMonthYear(d){ return d.toLocaleString(undefined,{month:'long',year:'numeric'}); }
    function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }

    function renderMonth(){
      grid.innerHTML='';
      const y=viewDate.getFullYear(), m=viewDate.getMonth();
      titleEl.textContent = fmtMonthYear(viewDate);
      const firstDow = new Date(y,m,1).getDay();
      const totalDays = daysInMonth(y,m);
      const prevDays = daysInMonth(y,m-1);
      const cells=[];
      for(let i=firstDow-1;i>=0;i--) cells.push({y,m:m-1,d:prevDays-i,other:true});
      for(let d=1; d<=totalDays; d++) cells.push({y,m,d,other:false});
      while(cells.length%7!==0) cells.push({y,m:m+1,d:cells.length-(firstDow+totalDays)+1,other:true});
      while(cells.length<42){ const last=cells[cells.length-1]; cells.push({y:last.y,m:last.m,d:last.d+1,other:true}); }

      const tY=today.getFullYear(), tM=today.getMonth(), tD=today.getDate();
      cells.forEach(c=>{
        const cell=document.createElement('div');
        cell.className='cell'+(c.other?' other-month':'');
        const dateBox=document.createElement('div'); dateBox.className='date'; dateBox.textContent=c.d;
        cell.appendChild(dateBox);
        if(c.y===tY && c.m===tM && c.d===tD && !c.other) cell.classList.add('today');
        const eventsWrap=document.createElement('div'); eventsWrap.className='events';
        cell.appendChild(eventsWrap);
        grid.appendChild(cell);
      });
    }
    document.getElementById('prevBtn').onclick=()=>{ viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()-1,1); renderMonth(); };
    document.getElementById('nextBtn').onclick=()=>{ viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()+1,1); renderMonth(); };
    document.getElementById('todayBtn').onclick=()=>{ today=new Date(); viewDate=new Date(today.getFullYear(),today.getMonth(),1); renderMonth(); };
    renderMonth();

    // ===== Filter pills (visual only for now)
    let currentFilter = 'ALL';
    document.querySelectorAll('.pill').forEach(p=>{
      p.addEventListener('click',()=>{
        document.querySelectorAll('.pill').forEach(x=>x.classList.remove('active'));
        p.classList.add('active');
        currentFilter = p.dataset.filter;
      });
    });

    // ===== Booking modal behavior
    const modal   = document.getElementById('bookingModal');
    const openBtn = document.getElementById('newBooking');
    const closeBtn= document.getElementById('closeModal');
    const cancelBtn=document.getElementById('cancelModal');
    const withInst=document.getElementById('withInstructor');
    const instWrap=document.getElementById('instructorWrap');
    const allDay  = document.getElementById('allDay');
    const startTime=document.getElementById('startTime');
    const endTime=document.getElementById('endTime');

    function openModal(){
      modal.classList.add('open');
      // defaults to today / rounded time
      const now=new Date();
      const pad=n=>String(n).padStart(2,'0');
      const yyyy=now.getFullYear(), mm=pad(now.getMonth()+1), dd=pad(now.getDate());
      document.getElementById('startDate').value=`${yyyy}-${mm}-${dd}`;
      document.getElementById('endDate').value=`${yyyy}-${mm}-${dd}`;
      const minutes=now.getMinutes(); const rounded=Math.ceil(minutes/30)*30; if(rounded===60){ now.setHours(now.getHours()+1); }
      const hh=pad(now.getHours()); const min=pad(rounded===60?0:rounded);
      startTime.value=`${hh}:${min}`;
      endTime.value=`${hh}:${pad((parseInt(min,10)+30)%60)}`;
      // email reflects auth state already
    }
    function closeModal(){ modal.classList.remove('open'); }
    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    modal.addEventListener('click',(e)=>{ if(e.target===modal) closeModal(); });

    withInst.onchange=()=>instWrap.hidden=!withInst.checked;
    allDay.onchange=()=>{ const dis=allDay.checked; startTime.disabled=dis; endTime.disabled=dis; if(dis){startTime.value=''; endTime.value='';} };

    // deltas
    function calcDelta(start,end,out){ const s=parseFloat(start.value), e=parseFloat(end.value); out.value=(isFinite(s)&&isFinite(e))?(e-s).toFixed(1):''; }
    const tachStart=document.getElementById('tachStart'), tachEnd=document.getElementById('tachEnd'), tachDelta=document.getElementById('tachDelta');
    const hobbsStart=document.getElementById('hobbsStart'), hobbsEnd=document.getElementById('hobbsEnd'), hobbsDelta=document.getElementById('hobbsDelta');
    ;[tachStart,tachEnd].forEach(el=>el.addEventListener('input',()=>calcDelta(tachStart,tachEnd,tachDelta)));
    ;[hobbsStart,hobbsEnd].forEach(el=>el.addEventListener('input',()=>calcDelta(hobbsStart,hobbsEnd,hobbsDelta)));

    // demo save
    document.getElementById('saveBooking').addEventListener('click', ()=>{
      const user = auth.currentUser;
      if(!user){ alert('Please sign in to book.'); return; }
      const fn=document.getElementById('firstName').value.trim();
      const ln=document.getElementById('lastName').value.trim();
      if(!fn || !ln){ alert('Please enter your first and last name.'); return; }

      const data={
        member_first: fn,
        member_last: ln,
        member_email: user.email||"",
        aircraft: document.getElementById('aircraft').value,
        title: document.getElementById('titleInput').value.trim(),
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        allDay: allDay.checked,
        withInstructor: withInst.checked,
        instructorId: document.getElementById('instructorSelect').value || null,
        tach_start: tachStart.value || null, tach_end: tachEnd.value || null,
        hobbs_start: hobbsStart.value || null, hobbs_end: hobbsEnd.value || null,
        comments: document.getElementById('comments').value.trim()
      };
      console.log('Booking (ready for backend wiring):', data);
      closeModal();
    });
  </script>
</body>
</html>
